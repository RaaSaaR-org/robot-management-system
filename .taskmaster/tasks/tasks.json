{
  "master": {
    "tasks": [
      {
        "id": "1",
        "title": "Setup Core Infrastructure (Foundation Phase)",
        "description": "Establish the foundational shared infrastructure including UI components, common hooks, API client, and state management store.",
        "details": "Implement the following modules as defined in Phase 0:\n- **shared/components/ui**: Implement primitive UI elements like `Button`, `Card`, `Input`, `Modal`, `Badge` with Tailwind CSS for styling.\n- **shared/hooks**: Create base hooks such as `useApi`, `useDebounce`, `useWebSocket`, `useLocalStorage`.\n- **api/client**: Set up an Axios instance with interceptors for handling authentication tokens, errors, and retries.\n- **store/createStore**: Implement a Zustand factory with middleware for devtools and persistence, ensuring it produces typed stores.",
        "testStrategy": "Utilize Vitest for unit tests on all implemented components and hooks. Mock API calls using MSW for `api/client` tests to ensure correct token handling and error responses. Verify that the Zustand store factory produces typed stores and integrates with devtools/persistence as expected.",
        "priority": "high",
        "dependencies": [],
        "status": "done",
        "subtasks": []
      },
      {
        "id": "2",
        "title": "Implement User Authentication & Authorization",
        "description": "Develop the full authentication flow including user login, token management, and role-based access control (RBAC).",
        "details": "Implement the following modules as defined in Phase 1:\n- **auth/store**: Create an authentication Zustand store to manage token state.\n- **auth/api**: Implement API calls for login, logout, and token refresh endpoints.\n- **auth/hooks**: Develop `useAuth()` hook for authentication state management.\n- **UI Components**: Create `LoginForm`, `LogoutButton` components using `shared/ui` primitives.\n- **ProtectedRoute**: Implement a component to guard routes based on authentication status.\n- **AuthProvider**: Establish a React context provider for authentication state.\n- **LoginPage**: Develop the login page that utilizes the `LoginForm` and `useAuth()` hook.",
        "testStrategy": "Perform unit tests for `auth/store`, `auth/api` (with mocked API), and `auth/hooks`. Use React Testing Library for `LoginForm`, `LogoutButton`, and `ProtectedRoute` components. Test critical scenarios including happy path (valid credentials, successful login, token stored), edge cases (empty fields, malformed email), and error cases (invalid credentials, network failure) as per PRD's critical test scenarios.",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "done",
        "subtasks": []
      },
      {
        "id": "3",
        "title": "Develop Core Robot Management Features",
        "description": "Implement essential CRUD operations and status display for individual robot entities within the platform.",
        "details": "Implement the following modules as defined in Phase 2:\n- **robots/types**: Define TypeScript types for `Robot`, `RobotStatus`, `RobotTelemetry`, `RobotCommand`, `CommandInterpretation`, etc.\n- **robots/store**: Create a Zustand store for robot data, supporting CRUD operations and filtering.\n- **robots/api**: Implement API calls for listing, getting, and sending commands to robots.\n- **robots/hooks**: Develop `useRobotList()` and `useRobot()` hooks for data fetching and state management.\n- **UI Components**: Create `RobotStatusBadge` (color-coded status), `RobotCard`, `RobotList` (paginated grid/list), and `RobotDetailPanel` (comprehensive single robot view) using `shared/ui` primitives.\n- **Pages**: Develop `RobotsPage` for listing and `RobotDetailPage` for individual robot details.",
        "testStrategy": "Conduct unit tests for `robots/types`, `robots/store`, `robots/api` (with mocked API), and `robots/hooks`. Use React Testing Library for UI components such as `RobotStatusBadge`, `RobotCard`, `RobotList`, and `RobotDetailPanel`. Critical test scenarios include fetching and displaying robot list (happy path), handling empty lists, and API failures, ensuring real-time status updates are reflected.",
        "priority": "high",
        "dependencies": [
          "1",
          "2"
        ],
        "status": "done",
        "subtasks": []
      },
      {
        "id": "4",
        "title": "Implement Task Lifecycle Management",
        "description": "Enable viewing, tracking, and basic management (cancel/pause) of tasks assigned to robots.",
        "details": "Implement the following modules as defined in Phase 3:\n- **tasks/types**: Define TypeScript types for `Task`, `TaskStatus`, `TaskStep`, etc., dependent on `robots/types`.\n- **tasks/store**: Create a Zustand store for task data.\n- **tasks/api**: Implement API calls for listing tasks, getting task details, and actions like cancelling or pausing tasks.\n- **tasks/hooks**: Develop `useTask()` and `useTaskQueue()` hooks.\n- **UI Components**: Create `TaskCard`, `TaskList` (with filtering), and `TaskTimeline` (step-by-step progress) components using `shared/ui` primitives.\n- **Pages**: Develop `TasksPage` to display the task list and provide detailed views.",
        "testStrategy": "Perform unit tests for `tasks/types`, `tasks/store`, `tasks/api` (mocked), and `tasks/hooks`. Use React Testing Library for UI components (`TaskCard`, `TaskList`, `TaskTimeline`) to verify correct data display and state transitions. Ensure that task status updates and actions like cancel/pause are correctly handled and reflected in the UI.",
        "priority": "medium",
        "dependencies": [
          "1",
          "3"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-14T00:08:11.439Z"
      },
      {
        "id": "5",
        "title": "Develop Real-time Telemetry & Monitoring",
        "description": "Integrate WebSocket-based real-time telemetry to display battery levels and sensor data for robots.",
        "details": "Implement the following features as part of Phase 4:\n- **telemetry/hooks**: Implement `useTelemetryStream()` using the `shared/hooks/useWebSocket` to connect to real-time telemetry feeds and consume data dependent on `robots/types`.\n- **UI Components**: Create a `BatteryGauge` component to visually represent battery levels with warnings, and a `SensorGrid` component to display key sensor readings in a readable format. These components should use `shared/ui` primitives and connect to the `useTelemetryStream()` hook. Ensure updates occur at 5-10 second intervals.",
        "testStrategy": "Unit test `useTelemetryStream()` hook with mocked WebSocket connections, simulating various telemetry data streams and disconnections. Use React Testing Library for `BatteryGauge` and `SensorGrid` components to verify correct visual representation and real-time updates based on incoming data. Test warning thresholds for battery levels.",
        "priority": "medium",
        "dependencies": [
          "1",
          "3"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-14T00:15:11.601Z"
      },
      {
        "id": "6",
        "title": "Implement Safety & Alert System",
        "description": "Integrate critical safety features including an emergency stop button and a comprehensive alert notification system.",
        "details": "Implement the following modules/features as part of Phase 4:\n- **alerts/types**: Define TypeScript types for `Alert`, `AlertSeverity`, dependent on `robots/types`.\n- **alerts/store**: Create a Zustand store for alert management.\n- **alerts/hooks**: Develop `useAlerts()` hook for alert management.\n- **UI Components**: Create `AlertBanner` (for critical/warning/info events), `AlertList` (displaying all active alerts), and an `EmergencyStopButton` (always-visible, sending immediate stop command via `robots/api`) using `shared/ui` primitives. Ensure alerts are displayed by severity and require acknowledgment for critical events.",
        "testStrategy": "Unit test `alerts/types`, `alerts/store`, `alerts/hooks`. Use React Testing Library for `AlertBanner`, `AlertList`, and `EmergencyStopButton`. Critical test scenarios for E-stop include tapping to immediately send a stop command, requiring confirmation to resume, and handling offline states by queuing commands. Test alert display based on severity, acknowledgment functionality, and integration with `robots/api` for the E-stop.",
        "priority": "high",
        "dependencies": [
          "1",
          "3",
          "5"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-14T00:31:38.387Z"
      },
      {
        "id": "7",
        "title": "Build Natural Language Command Interface",
        "description": "Develop the user interface for inputting and interpreting natural language commands for robots.",
        "details": "Implement the following modules/features as part of Phase 5:\n- **command/api**: Implement API calls for `sendCommand()` including VLA interpretation, dependent on `api/client` and `robots/types`.\n- **command/hooks**: Develop `useCommand()` hook, dependent on `command/api` and `robots/hooks`.\n- **UI Components**: Create a `CommandBar` for natural language text input, `CommandPreview` to display the VLA model's interpretation (action type, objects, confidence), `CommandConfirmation` modal for user confirmation before execution, and `CommandHistory` to log and search past commands. These components should use `shared/ui` primitives.",
        "testStrategy": "Unit test `command/api` (mocked API) and `command/hooks`. Use React Testing Library for `CommandBar`, `CommandPreview`, `CommandConfirmation`, and `CommandHistory`. Critical test scenarios include entering a command, displaying its interpretation, confirming execution, and logging history. Test edge cases like low confidence interpretations, ambiguous commands, VLA timeout, and blocked/prohibited actions with appropriate user feedback.",
        "priority": "high",
        "dependencies": [
          "1",
          "3",
          "5"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-14T01:00:59.810Z"
      },
      {
        "id": "8",
        "title": "Implement Safety Simulation Preview",
        "description": "Integrate a 2D/3D preview functionality for planned robot actions to enhance safety and user confidence.",
        "details": "Implement the `Safety Simulation Preview` feature as an advanced part of the Command Interface (Phase 5):\n- Integrate `Three.js` (chosen for its lighter weight and community support) for rendering the 2D/3D preview.\n- Utilize planned action data from `command/hooks` and current robot position/environment data (potentially from `telemetry/components` and `robots/hooks`) to generate an animated preview of the robot's path and actions.\n- The preview should highlight potential hazards and show grip points for manipulation tasks.\n- Start with a 2D path preview and iterate towards 3D simulation, as per risk mitigation strategies.",
        "testStrategy": "Conduct integration tests to ensure the simulation preview accurately reflects the planned action based on command interpretation. Visually inspect the 2D/3D animations for correctness. Test hazard highlighting and grip point visualization. Test with various command types and environmental conditions. Validate that the preview updates dynamically with changes in planned actions.",
        "priority": "medium",
        "dependencies": [
          "1",
          "5",
          "7"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-14T01:25:17.077Z"
      },
      {
        "id": "9",
        "title": "Develop Fleet Overview Dashboard & Map",
        "description": "Create a high-level fleet monitoring dashboard and an interactive map to visualize robot positions and aggregate statuses.",
        "details": "Implement the following modules/features as defined in Phase 6:\n- **fleet/hooks**: Develop `useFleetStatus()` hook, dependent on `robots/hooks` and `alerts/hooks`, to aggregate fleet-wide data.\n- **UI Components**: Create `FleetStats` for displaying KPI cards (robot counts by status, alert count, utilization metrics) using `shared/ui` primitives.\n- **FleetMap**: Implement an interactive 2D map using `Leaflet.js` to render floor plans and plot robot markers. Support zoom/pan and cluster markers for large fleets.\n- **ZoneOverlay**: Develop a component to display operational zones or exclusion areas on the `FleetMap`.\n- **FleetDashboard page**: Assemble `FleetStats`, `FleetMap`, `CommandBar` (from Task 7), and `AlertBanner` (from Task 6) into a comprehensive dashboard view.",
        "testStrategy": "Unit test `fleet/hooks` for correct data aggregation. Use React Testing Library for `FleetStats` components. For `FleetMap` and `ZoneOverlay`, perform integration tests to verify correct rendering of floor plans, accurate plotting of robot positions, marker clustering, and interactive features (zoom/pan). Ensure `FleetDashboard` correctly displays aggregated data and integrates other components.",
        "priority": "medium",
        "dependencies": [
          "1",
          "3",
          "6"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-14T02:02:29.577Z"
      },
      {
        "id": "10",
        "title": "Enhance Cross-Platform UI & Application Polish",
        "description": "Implement responsive layouts, dark mode support, offline capabilities, and finalize application routing for a production-ready experience.",
        "details": "Implement the following features as defined in Phase 7:\n- **Responsive Layouts**: Apply adaptive layouts for mobile, tablet, and desktop viewing across all pages, using breakpoints to adjust column counts (1/2/3).\n- **Navigation Components**: Create `MobileNav` and `Sidebar` components.\n- **Theme Switching**: Implement `ThemeProvider` with dark mode support (system-preference-aware with user override) using `shared/utils`.\n- **Offline Support**: Implement an offline indicator and caching mechanism using `shared/hooks/useOffline` and the global `store` to cache robot states and queue commands for syncing on reconnect.\n- **Layouts**: Create `DashboardLayout`, `AuthLayout`, and `MobileLayout` that incorporate navigation and core components.\n- **App Routing**: Finalize `app/Router` with lazy loading for all feature pages and integrating the new layouts.",
        "testStrategy": "Perform extensive end-to-end (E2E) testing with Playwright to verify responsive layouts across different viewport sizes. Test dark mode functionality, ensuring correct theme application based on system preference and user override. Validate offline support by simulating network disconnections: verify offline indicator, cached data display, and command queuing/syncing on reconnect. Test all routing and lazy loading works as expected. Accessibility testing with `axe-core` should be integrated for all UI components and pages.",
        "priority": "medium",
        "dependencies": [
          "1",
          "2",
          "3",
          "4",
          "5",
          "6",
          "7",
          "8",
          "9"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-14T02:29:12.553Z"
      },
      {
        "id": "11",
        "title": "Authentication & User Management (Full Stack)",
        "description": "Implement complete authentication system with user registration, password management, and account settings across frontend and server.",
        "details": "**Full-Stack Feature spanning Frontend + Server**\n\n## Frontend (`app/src/features/auth/`)\n- **Registration UI**: Create `RegistrationForm`, `RegisterPage` using types from `auth.types.ts` (`RegisterRequest`)\n- **Password Reset UI**: Create `ForgotPasswordForm`, `ResetPasswordForm`, `ForgotPasswordPage`, `ResetPasswordPage`\n- **Account Settings**: Create `AccountSettingsPanel`, `ChangePasswordForm`, `AccountPage`\n- **auth/api**: Wire registration endpoint `POST /auth/register`, password reset endpoints\n- **auth/store**: Add registration, password reset, account settings actions to `authStore.ts`\n- **auth/hooks**: Add `useRegistration()`, `usePasswordReset()`, `useAccountSettings()` hooks\n\n## Server (`server/src/`)\n- **Auth routes**: `POST /auth/register`, `POST /auth/forgot-password`, `POST /auth/reset-password`, `POST /auth/change-password`\n- **AuthService**: User CRUD, password hashing with bcrypt, JWT token generation\n- **Auth middleware**: JWT validation on protected routes\n- **Database**: User model with Prisma schema\n\n**Key Files:**\n- Frontend: `app/src/features/auth/types/auth.types.ts`, `app/src/features/auth/api/authApi.ts`, `app/src/features/auth/store/authStore.ts`\n- Server: Create `server/src/routes/auth.routes.ts`, `server/src/services/AuthService.ts`, `server/src/middleware/auth.middleware.ts`\n- Server: Update `server/prisma/schema.prisma` with User model",
        "testStrategy": "Frontend: Unit test auth store actions, React Testing Library for form components, E2E test registration/password reset flows. Server: Supertest for auth endpoints, test password hashing, test JWT validation, test token refresh flow.",
        "priority": "high",
        "dependencies": [
          "1",
          "2"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-22T22:11:16.478Z"
      },
      {
        "id": "12",
        "title": "Alerts System (Full Stack)",
        "description": "Implement comprehensive alerts system with history, acknowledgment, and real-time push across frontend, server, and robot client.",
        "details": "**Full-Stack Feature spanning Frontend + Server + Robot**\n\n## Frontend (`app/src/features/alerts/`)\n- **Alert History**: Create `AlertHistoryPanel`, `AlertsPage` with pagination\n- **Filters**: Create `AlertFilters` component (by severity, source, date range)\n- **Acknowledgment UI**: Add acknowledge button/action to alert components\n- **alerts/api**: Create `alertsApi.ts` with CRUD endpoints, wire to server\n- **alerts/store**: Update `alertsStore.ts` to fetch from API, add pagination state\n- **alerts/hooks**: Update `useAlerts()` to fetch from API, add `useAlertHistory()` hook\n\n## Server (`server/src/`)\n- **Alert routes**: `GET /api/alerts`, `POST /api/alerts`, `POST /api/alerts/:id/acknowledge`, `GET /api/alerts/history`\n- **AlertService**: Alert management, severity handling, acknowledgment logic\n- **WebSocket**: Push new alerts via existing WebSocket to connected clients\n- **Database**: Alert model with severity, source, acknowledged status\n\n## Robot Client (`robot-agent/src/`)\n- **Alert emission**: Enhance `robot/telemetry.ts` to emit alert events (errors, warnings, battery low)\n- **State tracking**: Update `robot/state.ts` to track alert conditions\n- **A2A events**: Send alert events to server via existing A2A protocol\n\n**Key Files:**\n- Frontend: `app/src/features/alerts/store/alertsStore.ts`, create `app/src/features/alerts/api/alertsApi.ts`\n- Server: Create `server/src/routes/alert.routes.ts`, `server/src/services/AlertService.ts`\n- Robot: `robot-agent/src/robot/telemetry.ts`, `robot-agent/src/robot/state.ts`",
        "testStrategy": "Frontend: Test API fetches alerts, test acknowledgment UI, test history pagination. Server: Test alert CRUD, test WebSocket push, test filtering. Robot: Test alert emission on error conditions, test battery low alerts.",
        "priority": "high",
        "dependencies": [
          "1",
          "6"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-22T22:42:32.474Z"
      },
      {
        "id": "13",
        "title": "Zone Management (Full Stack)",
        "description": "Implement zone management for fleet operations with zone editor, validation, and robot zone awareness.",
        "details": "**Full-Stack Feature spanning Frontend + Server + Robot**\n\n## Frontend (`app/src/features/fleet/`)\n- **Zone Editor**: Add zone drawing/editing mode to `FleetMap.tsx`\n- **Zone CRUD UI**: Create `ZoneEditor`, `ZoneConfigPanel`, `ZoneFormModal` components\n- **Zone Display**: Enhance `ZoneOverlay` to show zones with different colors by type\n- **fleet/api**: Create `fleetApi.ts` with zone CRUD endpoints\n- **fleet/store**: Create `zoneStore.ts` with Zustand for zone state\n- **fleet/hooks**: Create `useZones()`, `useZoneManagement()` hooks\n\n## Server (`server/src/`)\n- **Zone routes**: `GET /api/zones`, `POST /api/zones`, `PUT /api/zones/:id`, `DELETE /api/zones/:id`\n- **ZoneService**: Zone validation, overlap detection, coordinate handling\n- **Database**: Zone model with type (operational, exclusion, charging, staging), coordinates (polygon), color\n\n## Robot Client (`robot-agent/src/`)\n- **Zone awareness**: Update `tools/navigation.ts` to check zones before navigation\n- **Exclusion zones**: Prevent navigation into exclusion zones\n- **Current zone reporting**: Update `robot/state.ts` to report current zone (already has `zone` field)\n- **Zone events**: Emit events when entering/exiting zones\n\n**Key Files:**\n- Frontend: `app/src/features/fleet/components/FleetMap.tsx`, `app/src/features/fleet/types/fleet.types.ts`\n- Server: Create `server/src/routes/zone.routes.ts`, `server/src/services/ZoneService.ts`\n- Robot: `robot-agent/src/tools/navigation.ts`, `robot-agent/src/robot/state.ts`",
        "testStrategy": "Frontend: Test zone CRUD operations, test zone editor drawing, test zone display on map. Server: Test coordinate validation, test zone type enforcement, test overlap detection. Robot: Test zone-aware navigation, test exclusion zone blocking.",
        "priority": "medium",
        "dependencies": [
          "1",
          "9"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-23T00:08:31.659Z"
      },
      {
        "id": "14",
        "title": "User Settings & Preferences (Full Stack)",
        "description": "Build complete settings feature with user preferences, notifications, and appearance settings across frontend and server.",
        "details": "**Full-Stack Feature spanning Frontend + Server**\n\n## Frontend (`app/src/features/settings/`)\n- **Settings Page**: Create `SettingsPage` with tabbed navigation (appearance, notifications, security, profile)\n- **Settings Types**: Define `UserPreferences`, `NotificationSettings`, `AppSettings` in `settings.types.ts`\n- **Settings Components**: Create `GeneralSettings`, `NotificationSettings`, `AppearanceSettings`, `SecuritySettings`, `ProfileSettings`\n- **settings/api**: Create `settingsApi.ts` with `GET/PUT /api/settings`\n- **settings/store**: Expand beyond `themeStore.ts` to include all user preferences\n- **settings/hooks**: Create `useSettings()`, `useNotificationSettings()` hooks\n\n## Server (`server/src/`)\n- **Settings routes**: `GET /api/settings`, `PUT /api/settings`, notification preferences endpoints\n- **SettingsService**: User-specific settings management, defaults for new users\n- **Database**: UserSettings model tied to User\n\n**Note**: Robot client not affected - robot config via environment variables\n\n**Key Files:**\n- Frontend: `app/src/features/settings/store/themeStore.ts`, create `app/src/features/settings/types/settings.types.ts`\n- Server: Create `server/src/routes/settings.routes.ts`, `server/src/services/SettingsService.ts`\n- Server: Update `server/prisma/schema.prisma` with UserSettings model",
        "testStrategy": "Frontend: Test settings store persistence, test tab navigation, test each settings section updates store. Server: Test settings CRUD per user, test default settings for new users, test settings validation.",
        "priority": "medium",
        "dependencies": [
          "1",
          "2",
          "11"
        ],
        "status": "deferred",
        "subtasks": [],
        "updatedAt": "2025-12-22T21:21:44.009Z"
      },
      {
        "id": "15",
        "title": "NL Command Interpretation (Full Stack)",
        "description": "Implement natural language command interpretation with LLM integration, safety classification, and command history.",
        "details": "**Full-Stack Feature spanning Frontend + Server + Robot**\n\n## Frontend (`app/src/features/command/`)\n- **Wire to Server**: Update `commandApi.ts` to call server interpretation API instead of mock\n- **Command UI**: `CommandBar`, `CommandPreview`, `CommandConfirmation` already exist - wire to real API\n- **Command History**: Ensure `CommandHistory` component fetches from server API\n\n## Server (`server/src/`)\n- **Command routes**: `POST /api/command/interpret`, `GET /api/command/history`\n- **CommandInterpreter**: LLM integration (OpenAI/Anthropic) for NL interpretation\n- **Safety classification**: Classify commands as safe/caution/dangerous\n- **Confidence scoring**: Return confidence level (0-1) for interpretations\n- **Command history**: Store and retrieve command history with pagination\n\n## Robot Client (`robot-agent/src/`)\n- **Existing capability**: Already has Genkit/Gemini integration in `agent/agent-executor.ts`\n- **Server delegation**: Server can either interpret centrally or delegate to robot's Genkit\n- **Command execution**: Robot executes interpreted commands via existing tools\n\n**Key Files:**\n- Frontend: `app/src/features/command/api/commandApi.ts` - wire to server\n- Server: Create `server/src/routes/command.routes.ts`, `server/src/services/CommandInterpreter.ts`\n- Robot: `robot-agent/src/agent/agent-executor.ts` - already handles NL via Genkit",
        "testStrategy": "Frontend: Test command submission, test interpretation display, test history loading. Server: Test LLM interpretation, test confidence scores, test safety classification, test timeout handling. Robot: Test command execution via tools.",
        "priority": "high",
        "dependencies": [
          "1",
          "7"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T15:15:00.000Z"
      },
      {
        "id": "16",
        "title": "Database Persistence Layer (Server)",
        "description": "Add database persistence to the server - currently all data is in-memory and lost on restart.",
        "details": "**Server-Only Feature**\n\n## Server (`server/src/`)\n- **Database choice**: SQLite for development, PostgreSQL option for production\n- **ORM setup**: Add Prisma for TypeScript-first database access\n- **Schema design**: Create tables for:\n  - Users (auth)\n  - Robots (registration, status)\n  - Conversations (A2A protocol)\n  - Messages (conversation history)\n  - Tasks (A2A tasks)\n  - Alerts\n  - Zones\n  - UserSettings\n- **Migrations**: Set up Prisma migration system\n- **Service updates**: Replace in-memory Maps with database queries\n\n**Current State** (in-memory, data lost on restart):\n- `ConversationManager.ts` uses Maps for conversations, tasks, events, agents\n- `RobotManager.ts` uses Map for robots\n\n**Key Files:**\n- Create: `server/prisma/schema.prisma` - Full database schema\n- Create: `server/src/db/client.ts` - Prisma client setup\n- Update: `server/src/services/ConversationManager.ts` - Replace Maps with DB\n- Update: `server/src/services/RobotManager.ts` - Replace Maps with DB\n- Update: `server/package.json` - Add prisma, @prisma/client",
        "testStrategy": "Test data persists across server restarts. Test all CRUD operations work with database. Test migrations run successfully. Test connection handling. Test data integrity constraints.",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-22T21:42:13.152Z"
      },
      {
        "id": "17",
        "title": "Testing Infrastructure (Full Stack)",
        "description": "Set up comprehensive testing infrastructure across frontend, server, and robot client.",
        "details": "**Full-Stack Feature spanning Frontend + Server + Robot**\n\n## Frontend (`app/src/`)\n- **Test framework**: Configure Vitest for unit testing\n- **Component testing**: React Testing Library setup\n- **API mocking**: MSW (Mock Service Worker) for API mocking\n- **Test utilities**: Create `renderWithProviders`, `mockStore` helpers\n- **Coverage**: Configure c8 for coverage reporting\n- **Initial tests**: Auth, robots, tasks stores and components\n\n## Server (`server/src/`)\n- **Test framework**: Vitest or Jest configuration\n- **API testing**: Supertest for HTTP endpoint testing\n- **Database mocking**: Test database or Prisma mocking\n- **Test utilities**: Auth helpers, request builders\n- **Coverage**: Coverage reporting configuration\n\n## Robot Client (`robot-agent/src/`)\n- **Test framework**: Vitest or Jest configuration\n- **Unit tests**: Tests for state management, telemetry generation\n- **Tool tests**: Tests for navigation, manipulation tools\n- **Mock A2A**: Mock server for A2A protocol testing\n\n**Key Files:**\n- Frontend: Create `app/vitest.config.ts`, `app/src/test/setup.ts`, `app/src/test/utils.tsx`, `app/src/mocks/handlers.ts`\n- Server: Create `server/vitest.config.ts`, `server/src/__tests__/`\n- Robot: Create `robot-agent/vitest.config.ts`, `robot-agent/src/__tests__/`",
        "testStrategy": "Meta: Ensure all test runners work with `npm test` in each package. Verify coverage reports generate. Test MSW intercepts API calls. Verify test utilities work. Ensure CI/CD integration possible.",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "deferred",
        "subtasks": [],
        "updatedAt": "2025-12-22T21:19:35.639Z"
      },
      {
        "id": "18",
        "title": "Offline Support & Sync (Full Stack)",
        "description": "Implement offline capabilities with state caching, command queuing, and sync-on-reconnect.",
        "details": "**Full-Stack Feature spanning Frontend + Server**\n\n## Frontend (`app/src/`)\n- **Network detection**: Create `useOffline()` hook using navigator.onLine and online/offline events\n- **State caching**: Cache robot states, task states using IndexedDB or localStorage\n- **Command queue**: Implement command queue in `commandStore.ts` for offline execution\n- **Sync on reconnect**: Auto-sync queued commands when connection restores\n- **UI Components**: Create `OfflineIndicator`, `SyncStatus`, `QueuedCommandsPanel`\n\n## Server (`server/src/`)\n- **Sync endpoint**: `POST /api/sync` to receive queued commands\n- **Conflict resolution**: Handle conflicts when server state changed while offline\n- **Batch processing**: Process multiple queued commands efficiently\n\n**Note**: Robot client not affected - direct connection assumed\n\n**Key Files:**\n- Frontend: Create `app/src/shared/hooks/useOffline.ts`, `app/src/shared/components/OfflineIndicator.tsx`\n- Frontend: Update `app/src/features/command/store/commandStore.ts` - Add command queue\n- Server: Create sync endpoint for offline command processing",
        "testStrategy": "Frontend: Simulate network disconnection, verify cached data displays, test command queuing, test auto-sync on reconnect. Server: Test sync endpoint, test conflict resolution, test batch processing.",
        "priority": "medium",
        "dependencies": [
          "1",
          "3",
          "7"
        ],
        "status": "deferred",
        "subtasks": [],
        "updatedAt": "2025-12-22T21:20:12.700Z"
      },
      {
        "id": "19",
        "title": "Session Security (Full Stack)",
        "description": "Implement advanced session security with timeout detection, remember me, and account lockout.",
        "details": "**Full-Stack Feature spanning Frontend + Server**\n\n## Frontend (`app/src/features/auth/`)\n- **Session timeout**: Implement idle detection with auto-logout after inactivity\n- **Timeout warning**: Create session timeout warning modal before logout\n- **Remember me**: Add \"Remember Me\" checkbox to `LoginForm.tsx` (type already in `LoginRequest`)\n- **Idle detection**: Use `react-idle-timer` or custom hook in `AuthProvider.tsx`\n\n## Server (`server/src/`)\n- **Token refresh**: Implement refresh token rotation\n- **Session expiry**: Configure short-lived access tokens (15min) + longer refresh tokens\n- **Remember me**: Extend refresh token lifetime when remember me is checked (14 days vs 1 day)\n- **Account lockout**: Lock account after N failed login attempts (error type `ACCOUNT_LOCKED` exists)\n- **Lockout recovery**: Implement lockout timeout or admin unlock\n\n**Note**: Robot client not affected - robots use URL-based registration, no user auth\n\n**Key Files:**\n- Frontend: `app/src/features/auth/components/LoginForm.tsx`, `app/src/app/providers/AuthProvider.tsx`\n- Frontend: `app/src/features/auth/store/authStore.ts` - Add session timeout logic\n- Server: Update `server/src/services/AuthService.ts` - Add lockout logic\n- Server: Update `server/src/middleware/auth.middleware.ts` - Token validation",
        "testStrategy": "Frontend: Test session timeout triggers logout, test warning modal appears, test idle detection resets. Server: Test token refresh flow, test remember me extends session, test account locks after failed attempts, test lockout recovery.",
        "priority": "medium",
        "dependencies": [
          "1",
          "2",
          "11"
        ],
        "status": "deferred",
        "subtasks": [],
        "updatedAt": "2025-12-22T21:20:35.686Z"
      },
      {
        "id": "20",
        "title": "Structured Logging Infrastructure (Compliance)",
        "description": "Implement append-only structured logging with tamper-evident mechanisms for regulatory compliance across AI Act, GDPR, and Machinery Regulation.",
        "details": "**Regulatory Compliance Feature: AI Act Art. 12, GDPR Art. 30, MR Annex III**\n\n## Server (`server/src/`)\n- **Logging service**: Create `ComplianceLogService.ts` with:\n  - Append-only structured logging with hash chains for tamper evidence\n  - JSON format with ISO 8601 timestamps\n  - Fields: session_id, robot_id, operator_id, event_type, payload\n  - ML model version/hash logging for each AI operation\n  - Input-output matching records for AI decisions\n- **Log storage**: Implement write-once storage mechanism\n- **Log encryption**: AES-256-GCM for logs at rest\n- **Log access**: Role-based access with complete access audit trail\n- **Database**: Create ComplianceLog model with immutable flag\n\n## Robot Agent (`robot-agent/src/`)\n- **AI decision logging**: Log all Genkit AI decisions with context\n- **Safety decision recording**: Log safety-related decisions with confidence scores\n- **Movement logging**: Record navigation decisions for autonomous operations\n\n**Key Files:**\n- Server: Create `server/src/services/ComplianceLogService.ts`\n- Server: Create `server/src/routes/compliance-log.routes.ts`\n- Server: Update `server/prisma/schema.prisma` with ComplianceLog model\n- Robot: Update `robot-agent/src/agent/agent-executor.ts` for AI logging",
        "testStrategy": "Test log immutability (cannot modify existing logs). Test hash chain verification. Test AES-256 encryption at rest. Test role-based log access. Test AI decision logging captures all required fields. Verify timestamp accuracy and format.",
        "priority": "high",
        "dependencies": [
          "1",
          "16"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-10T14:07:23.594Z"
      },
      {
        "id": "21",
        "title": "Encryption & Secure Communication (Compliance)",
        "description": "Implement AES-256 encryption at rest and TLS 1.3 for all communications per GDPR Art. 32, NIS2, CRA, and EN 18031 requirements.",
        "details": "**Regulatory Compliance Feature: GDPR Art. 32, NIS2 Art. 21, CRA Annex I, EN 18031**\n\n## Server (`server/src/`)\n- **Database encryption**: Implement AES-256-GCM for SQLite/PostgreSQL data at rest\n- **TLS configuration**: Enforce TLS 1.3 for all HTTP/WebSocket connections\n- **Certificate management**: Create certificate rotation infrastructure\n- **Key management**: Implement secure key storage and rotation\n- **mTLS setup**: Configure mutual TLS for robot-to-server communication\n\n## Robot Agent (`robot-agent/src/`)\n- **TLS client**: Configure TLS 1.3 for server connections\n- **Device certificates**: Implement unique device certificate handling\n- **DTLS**: Configure DTLS for any UDP-based communications\n- **Key storage**: Secure local key storage\n\n## App (`app/src/`)\n- **HTTPS enforcement**: Ensure all API calls use HTTPS\n- **Certificate pinning**: Optional certificate pinning for mobile\n\n**Encryption Standards:**\n- AES-256-GCM for symmetric encryption\n- X25519 for key exchange\n- Ed25519 for signatures\n- SHA-256+ for hashing\n\n**Key Files:**\n- Server: Create `server/src/security/encryption.ts`\n- Server: Create `server/src/security/certificates.ts`\n- Robot: Update `robot-agent/src/api/server.ts` for TLS",
        "testStrategy": "Test TLS 1.3 is enforced (reject TLS 1.2 and below). Test database encryption/decryption. Test mTLS handshake between robot and server. Verify certificate rotation. Test key management operations.",
        "priority": "high",
        "dependencies": [
          "1",
          "16"
        ],
        "status": "deferred",
        "subtasks": [],
        "updatedAt": "2025-12-25T14:17:26.009Z"
      },
      {
        "id": "22",
        "title": "Multi-Factor Authentication (Compliance)",
        "description": "Implement FIDO2/WebAuthn and TOTP MFA per NIS2 Art. 21(2)(j) and CRA Annex I requirements.",
        "details": "**Regulatory Compliance Feature: NIS2 Art. 21(2)(j), CRA Annex I**\n\n## Server (`server/src/`)\n- **FIDO2/WebAuthn**: Primary MFA method implementation\n  - Registration flow for security keys\n  - Authentication flow with challenge/response\n  - Multiple key support per user\n- **TOTP fallback**: RFC 6238 TOTP as fallback option\n  - Secret generation and QR code display\n  - 6-digit code verification with time window\n- **Account lockout**: Lock after 5 failed MFA attempts\n- **Password requirements**: Minimum 12 characters, complexity rules\n- **First-use credential change**: Force password change on first login\n- **Privileged access management**: Enhanced auth for admin operations\n\n## App (`app/src/features/auth/`)\n- **MFA enrollment UI**: Security key registration, TOTP setup\n- **MFA challenge UI**: WebAuthn prompt, TOTP code input\n- **Recovery codes**: Display and manage recovery codes\n- **MFA settings**: Enable/disable MFA methods\n\n**Key Files:**\n- Server: Create `server/src/services/MFAService.ts`\n- Server: Update `server/src/routes/auth.routes.ts` with MFA endpoints\n- Server: Update `server/prisma/schema.prisma` with MFACredential model\n- App: Create `app/src/features/auth/components/MFAEnrollment.tsx`\n- App: Create `app/src/features/auth/components/MFAChallenge.tsx`",
        "testStrategy": "Test FIDO2 registration and authentication flow. Test TOTP code generation and verification. Test account lockout after failed attempts. Test password complexity requirements. Test recovery code usage.",
        "priority": "high",
        "dependencies": [
          "11",
          "19"
        ],
        "status": "deferred",
        "subtasks": [],
        "updatedAt": "2025-12-25T14:17:56.852Z"
      },
      {
        "id": "23",
        "title": "Device Identity & Secure Boot (Compliance)",
        "description": "Implement unique device certificates and secure boot verification per CRA Annex I, EN 18031, and MR Annex III.",
        "details": "**Regulatory Compliance Feature: CRA Annex I, EN 18031, MR Annex III**\n\n## Robot Agent (`robot-agent/src/`)\n- **Device certificates**: Generate and manage unique per-device X.509 certificates\n- **No default passwords**: Implement unique credential generation per device\n- **Secure boot verification**: Cryptographic signature verification at startup\n- **Software integrity**: Display installed software version and integrity status\n- **Anti-rollback**: Prevent installation of older vulnerable versions\n- **TPM integration**: Optional TPM 2.0 support for key storage\n- **Device identity API**: Expose device identity information securely\n\n## Server (`server/src/`)\n- **Device registry**: Store and validate device certificates\n- **Certificate issuance**: PKI infrastructure for device certificate management\n- **Device provisioning**: Secure device onboarding workflow\n- **Integrity verification**: Verify device software integrity on connection\n\n**Key Files:**\n- Robot: Create `robot-agent/src/security/device-identity.ts`\n- Robot: Create `robot-agent/src/security/secure-boot.ts`\n- Robot: Update `robot-agent/src/api/server.ts` for certificate auth\n- Server: Create `server/src/services/DeviceRegistryService.ts`\n- Server: Update `server/prisma/schema.prisma` with DeviceCertificate model",
        "testStrategy": "Test unique certificate generation per device. Test certificate-based authentication. Test software integrity verification. Test anti-rollback protection. Test device provisioning workflow.",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "deferred",
        "subtasks": [],
        "updatedAt": "2025-12-25T14:18:54.850Z"
      },
      {
        "id": "24",
        "title": "Comprehensive Audit Trail System (Compliance)",
        "description": "Implement complete audit trail system with retention policies per AI Act Art. 18-19, MR Annex III, and GDPR Art. 30.",
        "details": "**Regulatory Compliance Feature: AI Act Art. 18-19, MR Annex III, GDPR Art. 30**\n\n## Server (`server/src/`)\n- **Audit events**: Create comprehensive AuditEventService\n  - Safety software version changes (5-year retention)\n  - AI safety decisions (1-year retention)\n  - Intervention evidence collection\n  - Movement decisions for autonomous ops\n  - All CRUD operations on sensitive data\n- **RoPA registry**: Records of Processing Activities\n  - Processing purposes\n  - Data categories\n  - Recipients and transfers\n  - Retention periods\n  - Security measures\n- **Log export API**: Deployer-accessible log export (6-month minimum)\n- **Provider documentation**: 10-year retention for technical docs\n- **Access audit**: Log all audit log access attempts\n\n## App (`app/src/`)\n- **Audit log viewer**: Admin interface for viewing audit trails\n- **Export functionality**: Download audit logs in various formats\n- **Filter and search**: Query audit logs by date, user, action type\n\n**Retention Matrix:**\n- Technical documentation: 10 years\n- Safety software versions: 5 years\n- AI decision logs: 1 year\n- Operational logs: 6 months\n\n**Key Files:**\n- Server: Create `server/src/services/AuditEventService.ts`\n- Server: Create `server/src/services/RoPAService.ts`\n- Server: Create `server/src/routes/audit.routes.ts`\n- Server: Update `server/prisma/schema.prisma` with AuditEvent, RoPA models\n- App: Create `app/src/features/admin/components/AuditLogViewer.tsx`",
        "testStrategy": "Test audit event capture for all required actions. Test retention policy enforcement. Test log export API. Test RoPA registry completeness. Test access audit logging. Verify data cannot be modified after creation.",
        "priority": "high",
        "dependencies": [
          "20",
          "16"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-10T15:54:46.003Z"
      },
      {
        "id": "25",
        "title": "Data Retention Engine (Compliance)",
        "description": "Implement automated data retention enforcement per AI Act Art. 19, GDPR Art. 5(1)(e), and MR Annex III.",
        "details": "**Regulatory Compliance Feature: AI Act Art. 19, GDPR Art. 5(1)(e), MR Annex III**\n\n## Server (`server/src/`)\n- **Retention policies**: Create RetentionPolicyService\n  - Configurable retention periods per data type\n  - Automated deletion scheduling (cron jobs)\n  - Exception handling for legal holds\n- **Data categories and periods:**\n  - Technical documentation: 10 years\n  - Safety software versions: 5 years per upload\n  - AI decision logs: 1 year minimum\n  - Deployer operational logs: 6 months\n  - CCTV/video (no incident): 72 hours-7 days\n  - Training records: 2 years\n  - First aid/incident records: 5 years\n- **Deletion audit**: Create proof-of-deletion logs\n- **Legal hold**: Suspend deletion for data under legal hold\n- **Archive tier**: Move data to cold storage before deletion\n\n**Key Files:**\n- Server: Create `server/src/services/RetentionPolicyService.ts`\n- Server: Create `server/src/jobs/retention-cleanup.ts`\n- Server: Create `server/src/routes/retention.routes.ts`\n- Server: Update `server/prisma/schema.prisma` with RetentionPolicy, LegalHold models",
        "testStrategy": "Test automated deletion at retention periods. Test deletion audit logging. Test legal hold prevents deletion. Test archive tier functionality. Test configurable retention per data type.",
        "priority": "high",
        "dependencies": [
          "16",
          "24"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "26",
        "title": "GDPR Rights Self-Service Portal (Compliance)",
        "description": "Implement GDPR data subject rights portal per Articles 15-22 (access, rectification, erasure, portability, objection).",
        "details": "**Regulatory Compliance Feature: GDPR Articles 15-22**\n\n## Server (`server/src/`)\n- **Art. 15 Access**: Self-service data export endpoint\n  - Compile all user data\n  - Third-party pixelation for CCTV\n  - 30-day response SLA tracking\n- **Art. 16 Rectification**: Data correction interface\n  - Edit interface for correctable data\n  - Audit trail of corrections\n- **Art. 17 Erasure**: Automated deletion workflows\n  - Right to be forgotten requests\n  - Exception handling (legal retention)\n- **Art. 18 Restriction**: Data flagging mechanism\n  - Processing limitation during disputes\n- **Art. 20 Portability**: Machine-readable export\n  - JSON/CSV export formats\n  - Automated data only\n- **Art. 21 Object**: Objection registration\n  - Re-assessment workflow\n- **Art. 22 ADM Safeguards**: Automated decision making\n  - Human intervention queue\n  - Contest workflow\n  - 72-hour acknowledgment SLA\n\n## App (`app/src/features/privacy/`)\n- **Privacy portal**: Self-service GDPR rights interface\n- **Data export**: Download personal data\n- **Deletion request**: Submit erasure requests\n- **Consent management**: View and manage consents\n- **Request tracking**: Track GDPR request status\n\n**Key Files:**\n- Server: Create `server/src/services/GDPRService.ts`\n- Server: Create `server/src/routes/gdpr.routes.ts`\n- Server: Update `server/prisma/schema.prisma` with GDPRRequest model\n- App: Create `app/src/features/privacy/` feature module\n- App: Create `app/src/features/privacy/components/PrivacyPortal.tsx`",
        "testStrategy": "Test data export completeness. Test erasure workflow including exceptions. Test portability export formats. Test request SLA tracking. Test human intervention queue for ADM. Test third-party data pixelation.",
        "priority": "high",
        "dependencies": [
          "11",
          "16"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "27",
        "title": "Incident Reporting Infrastructure (Compliance)",
        "description": "Implement incident detection and multi-authority reporting per AI Act Art. 73, GDPR Art. 33-34, NIS2 Art. 23, and CRA Art. 14.",
        "details": "**Regulatory Compliance Feature: AI Act Art. 73, GDPR Art. 33-34, NIS2 Art. 23, CRA Art. 14**\n\n## Server (`server/src/`)\n- **Incident detection**:\n  - Safety incident triggers (force/collision events)\n  - Security incident triggers (intrusion, auth failures)\n  - Anomaly detection in robot behavior\n- **Evidence preservation**:\n  - Immutable incident logging\n  - System state snapshots on incident\n- **Breach assessment**:\n  - Risk scoring matrix\n  - Automated severity classification\n- **Notification workflows** with authority-specific timelines:\n  - **AI Act**: 2/10/15 days depending on severity\n  - **GDPR**: 72 hours to DPA, immediate to data subjects if high risk\n  - **NIS2**: 24h early warning, 72h notification, 1 month final\n  - **CRA**: 24h for exploited vulnerabilities\n- **Timeline tracking**: Dashboard for deadline compliance\n- **Template system**: Pre-built notification templates per authority\n\n## App (`app/src/features/incidents/`)\n- **Incident dashboard**: View and manage incidents\n- **Reporting workflow**: Guide through notification process\n- **Timeline tracker**: Visual timeline of required actions\n- **Template editor**: Customize notification templates\n\n**Key Files:**\n- Server: Create `server/src/services/IncidentService.ts`\n- Server: Create `server/src/services/BreachAssessmentService.ts`\n- Server: Create `server/src/routes/incident.routes.ts`\n- Server: Update `server/prisma/schema.prisma` with Incident, IncidentNotification models\n- App: Create `app/src/features/incidents/` feature module",
        "testStrategy": "Test incident auto-detection triggers. Test evidence preservation immutability. Test severity classification. Test notification timeline tracking. Test template generation. Test multi-authority workflow.",
        "priority": "high",
        "dependencies": [
          "12",
          "24"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "28",
        "title": "Vulnerability Management & SBOM (Compliance)",
        "description": "Implement Software Bill of Materials and vulnerability management per CRA Art. 14 and Annex V.",
        "details": "**Regulatory Compliance Feature: CRA Art. 14, Annex V**\n\n## Server (`server/src/`)\n- **SBOM generation**: Automated Software Bill of Materials\n  - npm/package dependencies\n  - System libraries\n  - CycloneDX or SPDX format\n- **SBOM storage**: 10-year retention requirement\n- **Vulnerability tracking**:\n  - CVE monitoring for dependencies\n  - Severity classification (CVSS)\n  - Affected component mapping\n- **Disclosure program**: Coordinated vulnerability disclosure\n  - Security contact publication\n  - Disclosure timeline management\n- **Patch management**:\n  - Security update tracking\n  - Patch release workflow\n\n## Robot Agent (`robot-agent/src/`)\n- **Local SBOM**: Generate robot software SBOM\n- **Vulnerability status**: Report known vulnerabilities\n\n## App (`app/src/features/security/`)\n- **SBOM viewer**: Display component inventory\n- **Vulnerability dashboard**: Track CVEs and patches\n- **Disclosure portal**: Public vulnerability reporting\n\n**Key Files:**\n- Server: Create `server/src/services/SBOMService.ts`\n- Server: Create `server/src/services/VulnerabilityService.ts`\n- Server: Create `server/src/routes/security.routes.ts`\n- Robot: Create `robot-agent/src/security/sbom.ts`\n- App: Create `app/src/features/security/` feature module",
        "testStrategy": "Test SBOM generation completeness. Test CVE monitoring and alerting. Test vulnerability severity classification. Test SBOM export formats (CycloneDX, SPDX). Test disclosure workflow.",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "deferred",
        "subtasks": [],
        "updatedAt": "2025-12-29T15:42:52.499Z"
      },
      {
        "id": "29",
        "title": "Secure Update System OTA (Compliance)",
        "description": "Implement secure over-the-air updates with signing, rollback, and approval workflows per CRA Art. 13 and MR Art. 10.",
        "details": "**Regulatory Compliance Feature: CRA Art. 13, MR Art. 10, Annex I**\n\n## Server (`server/src/`)\n- **Update packages**: Signed update package creation\n  - Ed25519 signature on all packages\n  - Version metadata and changelog\n- **Update distribution**:\n  - TLS 1.3 delivery only\n  - Integrity verification endpoint\n  - Update availability notification\n- **Approval workflows**:\n  - Safety update impact assessment\n  - Change control board approval for safety updates\n  - Dual approval for critical updates\n- **Rollback management**:\n  - Previous version storage\n  - Rollback trigger conditions\n\n## Robot Agent (`robot-agent/src/`)\n- **Secure update client**:\n  - Signature verification before install\n  - Atomic updates (all-or-nothing)\n  - Automatic rollback on failure\n  - Anti-rollback for security updates\n- **Update notifications**: User notification of available updates\n- **Opt-out support**: Allow update deferral (not default)\n\n## App (`app/src/features/updates/`)\n- **Update management**: Admin interface for updates\n- **Rollback controls**: Trigger rollback for fleet\n- **Approval UI**: Approve pending updates\n\n**Update Support Period: 5-10 years after market placement**\n\n**Key Files:**\n- Server: Create `server/src/services/UpdateService.ts`\n- Server: Create `server/src/routes/update.routes.ts`\n- Robot: Create `robot-agent/src/updates/secure-update.ts`\n- App: Create `app/src/features/updates/` feature module",
        "testStrategy": "Test package signing and verification. Test atomic update installation. Test rollback on failure. Test anti-rollback protection. Test approval workflow. Test TLS-only delivery.",
        "priority": "high",
        "dependencies": [
          "23",
          "28"
        ],
        "status": "deferred",
        "subtasks": [],
        "updatedAt": "2025-12-25T14:25:45.077Z"
      },
      {
        "id": "30",
        "title": "Enhanced E-Stop & Safety Monitoring (Compliance)",
        "description": "Enhance emergency stop and safety monitoring per MR Annex III, ISO 10218-1, and ISO/TS 15066 requirements.",
        "details": "**Regulatory Compliance Feature: MR Annex III, ISO 10218-1, ISO/TS 15066**\n\n## Robot Agent (`robot-agent/src/`)\n- **Safety monitoring at 1kHz**:\n  - Force/torque monitoring (Butterworth 100Hz filter)\n  - Speed limiting (250 mm/s TCP in manual mode)\n  - Position/proximity monitoring\n- **Communication timeout**: Safe state on server disconnect (1s default)\n- **Protective stop logging**: Full context capture on stop events\n- **Safety-rated monitored stop**: Stop Category 2 implementation\n- **Fail-safe**: Automatic protective stop on any safety system failure\n\n## Server (`server/src/`)\n- **E-stop endpoints**:\n  - Individual robot halt\n  - Fleet-wide emergency stop\n  - Geographic zone stop\n- **E-stop status**: Real-time status via WebSocket\n- **Reset workflow**: Deliberate separate start action required\n- **E-stop logging**: Capture all e-stop events with context\n\n## App (`app/src/features/safety/`)\n- **Enhanced E-stop button**: Per-robot and fleet-wide\n- **Zone-based stop**: Stop robots in specific zones\n- **Safety status dashboard**: Real-time safety metrics\n- **Stop confirmation**: Visual confirmation of stop state\n\n**ISO/TS 15066 Force Limits** (stored in config):\n- Skull/Forehead: 130N (contact not permissible)\n- Hands/Fingers: 140N quasi-static, 280N transient\n\n**Key Files:**\n- Robot: Update `robot-agent/src/tools/navigation.ts` for speed limits\n- Robot: Create `robot-agent/src/safety/force-monitor.ts`\n- Server: Create `server/src/routes/safety.routes.ts`\n- Server: Update WebSocket for e-stop status\n- App: Update `app/src/features/alerts/components/EmergencyStopButton.tsx`",
        "testStrategy": "Test e-stop response time (<100ms). Test fleet-wide stop. Test zone-based stop. Test reset workflow. Test communication timeout triggers safe state. Test force limit enforcement. Test protective stop logging.",
        "priority": "high",
        "dependencies": [
          "6"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-29T16:09:22.572Z"
      },
      {
        "id": "31",
        "title": "Human Oversight Dashboard (Compliance)",
        "description": "Implement human oversight mechanisms per AI Act Art. 14 including intervention, override, and explainability.",
        "details": "**Regulatory Compliance Feature: AI Act Art. 14**\n\n## App (`app/src/features/oversight/`)\n- **Intervention capabilities**:\n  - Stop/interrupt per robot and fleet-wide (Art. 14(4)(e))\n  - Manual task reassignment (Art. 14(4)(d))\n  - Local manual control mode activation\n- **Capability understanding** (Art. 14(4)(a)):\n  - Robot capabilities dashboard\n  - Current limitations display\n  - Confidence level indicators\n  - Anomaly indicators with visual alerts\n- **Output interpretation** (Art. 14(4)(c)):\n  - Decision explanation interface\n  - Input factors visualization\n  - Decision logic display\n  - Confidence scores\n  - Alternatives considered\n- **Automation bias prevention** (Art. 14(3)):\n  - Confirmation prompts for safety-critical decisions\n  - Periodic manual verification requirements\n  - Training module on automation bias\n\n## Server (`server/src/`)\n- **Oversight API**: Endpoints for all intervention actions\n- **Decision logging**: Store all oversight interactions\n- **Alert integration**: Configurable alert thresholds\n\n**Alert Response Times:**\n- Safety violation: 100ms\n- Anomaly detection: 1 second\n- System failure: Immediate\n\n**Key Files:**\n- App: Create `app/src/features/oversight/` feature module\n- App: Create `app/src/features/oversight/components/OversightDashboard.tsx`\n- App: Create `app/src/features/oversight/components/DecisionExplainer.tsx`\n- Server: Create `server/src/routes/oversight.routes.ts`",
        "testStrategy": "Test intervention actions complete within SLA. Test capability dashboard accuracy. Test decision explanation completeness. Test automation bias prevention prompts. Test alert response times.",
        "priority": "high",
        "dependencies": [
          "3",
          "6",
          "30"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "32",
        "title": "AI Explainability API (Compliance)",
        "description": "Implement AI decision explainability and transparency per AI Act Art. 13 and Art. 50.",
        "details": "**Regulatory Compliance Feature: AI Act Art. 13, Art. 50**\n\n## Robot Agent (`robot-agent/src/`)\n- **Decision explanation generation**:\n  - Capture input factors for each decision\n  - Extract decision logic from Genkit\n  - Calculate and report confidence scores\n  - Track alternatives considered\n- **AI disclosure**: Audio/visual indicator when AI is active\n\n## Server (`server/src/`)\n- **Explainability API** (Art. 13(1)):\n  - GET /api/decisions/:id/explanation\n  - Returns: input_factors, decision_logic, confidence_score, alternatives\n- **Performance metrics** (Art. 13(3)(b)):\n  - Precision/recall metrics\n  - Error rates tracking\n  - Drift indicators\n- **Documentation endpoints** (Art. 13(3)(a)):\n  - Intended purpose\n  - Accuracy metrics\n  - Known limitations\n  - Human oversight requirements\n- **Limitation disclosure** (Art. 13(3)(c)):\n  - Operating conditions\n  - Environmental constraints\n  - Population performance variations\n\n## App (`app/src/features/explainability/`)\n- **Decision viewer**: Visualize AI decision factors\n- **Performance dashboard**: Metrics and drift indicators\n- **Documentation portal**: Access system documentation\n\n**Key Files:**\n- Robot: Create `robot-agent/src/ai/explainability.ts`\n- Robot: Update `robot-agent/src/agent/agent-executor.ts` for explanation capture\n- Server: Create `server/src/services/ExplainabilityService.ts`\n- Server: Create `server/src/routes/explainability.routes.ts`\n- App: Create `app/src/features/explainability/` feature module",
        "testStrategy": "Test explanation generation for all decision types. Test confidence score calculation. Test alternatives tracking. Test performance metrics accuracy. Test AI disclosure indicator.",
        "priority": "high",
        "dependencies": [
          "15"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T16:30:00.000Z"
      },
      {
        "id": "33",
        "title": "Technical Documentation System (Compliance)",
        "description": "Implement technical documentation management per AI Act Annex IV, MR Annex IV, CRA Annex V, and RED Annex V.",
        "details": "**Regulatory Compliance Feature: AI Act Annex IV, MR Annex IV, CRA Annex V, RED Annex V**\n\n## Server (`server/src/`)\n- **AI System Technical File** (AI Act Annex IV):\n  - General description storage\n  - Design specifications\n  - Data requirements documentation\n  - Risk management records\n  - Testing/validation results\n  - Post-market monitoring plan\n- **Machinery Technical File** (MR Annex IV):\n  - Drawings and diagrams\n  - Risk assessment records\n  - Applied standards list\n  - Test reports\n  - Instructions storage\n- **Cybersecurity Documentation** (CRA Annex V):\n  - Security architecture docs\n  - Attack surface analysis\n  - SBOM integration\n  - Vulnerability handling procedures\n- **Risk assessment storage**:\n  - AI risk management (Art. 9)\n  - Machinery risk (ISO 12100)\n  - DPIA documents\n  - Cybersecurity assessments\n  - Occupational assessments\n- **Conformity declarations**: EU Declaration of Conformity management\n- **Document versioning**: Full audit trail with retention\n- **Public URL**: Publicly accessible conformity documents\n\n**Retention: 10 years after last unit placed on market**\n\n**Key Files:**\n- Server: Create `server/src/services/TechnicalDocService.ts`\n- Server: Create `server/src/routes/documentation.routes.ts`\n- Server: Update `server/prisma/schema.prisma` with TechnicalDoc, RiskAssessment models",
        "testStrategy": "Test document upload and versioning. Test 10-year retention enforcement. Test public URL access for conformity docs. Test risk assessment linkage. Test audit trail completeness.",
        "priority": "high",
        "dependencies": [
          "24"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-10T16:24:53.840Z"
      },
      {
        "id": "34",
        "title": "Compliance Monitoring Dashboard (Compliance)",
        "description": "Implement unified compliance monitoring dashboard tracking all regulatory frameworks and deadlines.",
        "details": "**Regulatory Compliance Feature: All Frameworks**\n\n## App (`app/src/features/compliance/`)\n- **Regulatory tracker**:\n  - Timeline of regulatory deadlines\n  - Status per framework (AI Act, MR, GDPR, NIS2, CRA, RED, DGUV)\n  - Gap analysis reporting\n- **Document management**:\n  - Document expiry alerts\n  - Certification status\n  - Missing document identification\n- **Training compliance** (DGUV):\n  - Training record tracking\n  - Annual refresh reminders\n  - Competence verification status\n- **Inspection schedules** (DGUV Vorschrift 3):\n  - Electrical inspection (every 4 years)\n  - Force verification (annual)\n  - Biomechanical verification (annual)\n- **Risk assessment tracking**:\n  - Due date monitoring\n  - Update trigger tracking\n\n## Server (`server/src/`)\n- **Compliance API**: Aggregate compliance status\n- **Alert generation**: Deadline and expiry alerts\n- **Report generation**: Compliance reports for auditors\n\n**Key Dates Tracked:**\n- April 2025: NIS2 registration\n- August 2025: RED EN 18031\n- January 2027: Machinery Regulation\n- August 2027: EU AI Act\n- December 2027: CRA\n\n**Key Files:**\n- App: Create `app/src/features/compliance/` feature module\n- App: Create `app/src/features/compliance/components/ComplianceDashboard.tsx`\n- Server: Create `server/src/services/ComplianceTrackerService.ts`\n- Server: Create `server/src/routes/compliance.routes.ts`",
        "testStrategy": "Test deadline tracking accuracy. Test alert generation for approaching deadlines. Test gap analysis reporting. Test training record management. Test inspection schedule tracking.",
        "priority": "medium",
        "dependencies": [
          "24",
          "27",
          "33"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "35",
        "title": "Human Approval Workflows (Compliance)",
        "description": "Implement human approval workflows for automated decisions per GDPR Art. 22 and AI Act Art. 14.",
        "details": "**Regulatory Compliance Feature: GDPR Art. 22, AI Act Art. 14**\n\n## Server (`server/src/`)\n- **Approval workflows**:\n  - Performance evaluation affecting worker: 48-hour SLA human review\n  - Shift/role change based on performance: Supervisor approval required\n  - Disciplinary action trigger: Manager sign-off mandatory (cannot proceed without)\n  - Safety parameter modification: Dual approval (safety officer + admin)\n  - Software update affecting safety: Change control board + rollback plan\n- **Worker rights** (EDPB WP251):\n  - Obtain human intervention endpoint\n  - Express viewpoint submission\n  - Contest decision workflow\n- **Approval tracking**:\n  - SLA monitoring\n  - Escalation paths\n  - Audit trail of approvals\n- **Meaningful oversight**:\n  - Active engagement verification\n  - No rubber-stamping detection\n  - Authority and competence verification\n\n## App (`app/src/features/approvals/`)\n- **Approval queue**: Pending approvals dashboard\n- **Review interface**: Decision review with context\n- **Escalation management**: Handle overdue approvals\n- **Worker portal**: Submit viewpoints, contest decisions\n\n**Key Files:**\n- Server: Create `server/src/services/ApprovalWorkflowService.ts`\n- Server: Create `server/src/routes/approval.routes.ts`\n- Server: Update `server/prisma/schema.prisma` with Approval, ApprovalChain models\n- App: Create `app/src/features/approvals/` feature module\n- App: Create `app/src/features/approvals/components/ApprovalQueue.tsx`",
        "testStrategy": "Test approval workflow routing. Test SLA enforcement and escalation. Test dual approval for safety changes. Test worker viewpoint submission. Test contest workflow. Test meaningful oversight verification.",
        "priority": "high",
        "dependencies": [
          "11",
          "31"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "36",
        "title": "Enhanced Process-Robot Task Delegation with Retry-Reassign",
        "description": "Enhance the process-to-robot task delegation system to automatically reassign failed tasks to different robots after exhausting retries on the same robot.",
        "details": "**Enhancement to Existing Process System**\n\nSee `docs/process-delegation-architecture.md` for full architecture.\n\n## Current Behavior\n- When a robot fails a task, ProcessManager retries on the same robot\n- After maxRetries, the entire process fails\n\n## Enhanced Behavior\n1. Retry on same robot first (configurable, e.g., 2 retries)\n2. After same-robot retries exhausted, reassign to different robot\n3. Track `failedRobotIds` to exclude from future assignments\n4. Continue until success OR all eligible robots exhausted\n\n## Implementation Steps\n\n### Step 1: Update Types\n**File**: `server/src/types/process.types.ts`\n- Add `failedRobotIds?: string[]` to `StepInstance`\n- Add `reassignmentCount?: number` to `StepInstance`\n- Add `maxReassignments?: number` to `StepTemplate`\n\n### Step 2: Update ProcessRepository\n**File**: `server/src/repositories/ProcessRepository.ts`\n- Add `addFailedRobotToStep(stepId, robotId)` method\n- Add `resetStepRetryCount(stepId)` method\n\n### Step 3: Enhance ProcessManager\n**File**: `server/src/services/ProcessManager.ts`\n- Modify `handleStepFailure()` to check reassignment eligibility\n- Add `shouldReassignStep(step)` helper\n- Add `reassignStep(step)` method\n- Emit `step:reassigned` event\n\n### Step 4: Update TaskDistributor\n**File**: `server/src/services/TaskDistributor.ts`\n- Modify `findEligibleRobots()` to accept `excludeRobotIds`\n- Pass exclude list when reassigning\n\n### Step 5: Add WebSocket Event\n**File**: `server/src/types/process.types.ts`\n- Add `StepReassignedEvent` type\n\n### Step 6: Update Frontend (Optional)\n**File**: `app/src/features/processes/types/process.types.ts`\n- Mirror type changes\n- Show reassignment info in TaskTimeline\n\n**Key Files:**\n- `server/src/types/process.types.ts`\n- `server/src/services/ProcessManager.ts`\n- `server/src/services/TaskDistributor.ts`\n- `server/src/repositories/ProcessRepository.ts`\n- `docs/process-delegation-architecture.md`",
        "testStrategy": "Test same-robot retry works (retry count increments). Test reassignment triggers after max same-robot retries. Test failedRobotIds excludes robots. Test process completes when reassigned robot succeeds. Test process fails when all robots exhausted. Test WebSocket events for reassignment.",
        "priority": "medium",
        "dependencies": [
          "4"
        ],
        "status": "done",
        "subtasks": []
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2026-01-10T16:24:53.841Z",
      "taskCount": 36,
      "completedCount": 21,
      "tags": [
        "master"
      ]
    }
  }
}